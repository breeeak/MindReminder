# Epic 4: 日历可视化与统计

**用户成果：** 用户通过日历热力图直观看到学习轨迹，了解学习进度和成就

**覆盖需求：**
- FR19-FR26: 日历与可视化全部功能
- FR44-FR49: 统计与分析功能
- FR27-FR32: 日记管理
- FR33-FR39: 提醒事项管理

---

## Story 4.1: 日历热力图基础

As a **学习者**,
I want **通过日历热力图查看学习活动**,
So that **我可以直观了解学习频率和坚持情况**.

**Acceptance Criteria:**

**Given** 用户打开日历视图
**When** 页面加载完成
**Then** 显示当月日历热力图
**And** 每个日期方块显示：
- 该日新增的知识点数量
- 该日完成的复习数量
- 热力颜色（0活动=灰色 → 高活动=深蓝色）

**And** 颜色分级（6级）：
- 0个活动：浅灰色 (#f0f0f0)
- 1-2个：极浅蓝 (#c6e3ff)
- 3-5个：浅蓝 (#91d5ff)
- 6-10个：中蓝 (#40a9ff)
- 11-15个：深蓝 (#1890ff)
- 16+个：极深蓝 (#096dd9)

**When** 用户悬停在日期上
**Then** 显示工具提示：
- 日期
- 新增知识点数量
- 复习完成数量
- 日记标记（如果有）
- 提醒事项数量（如果有）

**When** 用户点击日期
**Then** 在侧边栏显示该日详情：
- 该日新增的知识点列表
- 该日复习的知识点列表
- 日记预览（如果有）
- 提醒事项列表（如果有）

**And** 列表项可点击跳转到详情页面

---

## Story 4.2: 多视图切换

As a **学习者**,
I want **在不同时间尺度查看学习数据**,
So that **我可以从不同角度了解学习情况**.

**Acceptance Criteria:**

**Given** 用户在日历视图
**When** 用户点击视图切换按钮
**Then** 可以选择以下视图：
- 月视图（默认）
- 周视图
- 年视图

**When** 切换到周视图
**Then** 显示当周7天的详细信息
**And** 每天显示为卡片，包含：
- 日期和星期
- 新增知识点列表（带标题）
- 复习知识点列表（带标题和评分）
- 日记摘要
- 完成状态（如"复习完成3/5"）

**When** 切换到年视图
**Then** 显示全年365天的热力图
**And** 按月分组排列
**And** 支持滚动查看
**And** 显示年度统计：
- 总学习天数
- 最长连续天数
- 总知识点数
- 总复习次数

**And** 视图切换动画流畅（< 300ms）
**And** 视图状态保持（刷新后仍保持上次选择）

---

## Story 4.3: 今日摘要和每日统计

As a **学习者**,
I want **快速了解今日学习情况**,
So that **我可以掌握每日进度和成就感**.

**Acceptance Criteria:**

**Given** 用户打开应用主页
**When** 页面顶部显示今日摘要卡片
**Then** 卡片显示以下信息：
- 今日日期
- 新增知识点数量
- 待复习知识点数量
- 已完成复习数量
- 复习完成率进度条
- "开始复习"快捷按钮

**When** 用户点击摘要卡片的不同区域
**Then** 跳转到对应页面：
- 点击"新增X个" → 今日新增列表
- 点击"待复习X个" → 复习任务列表
- 点击"已完成X个" → 今日完成列表

**When** 用户在设置中查看统计
**Then** 显示更详细的统计数据：
- 本周统计（每日新增、复习、完成率）
- 本月统计
- 知识点总数
- 已掌握数量和占比
- 平均复习完成率
- 连续学习天数（当前/最长）

**And** 统计数据使用图表可视化（Ant Design Charts）
**And** 数据实时更新

---

## Story 4.4: 日记功能

As a **学习者**,
I want **记录每日学习心得和思考**,
So that **我可以回顾学习历程，记录成长**.

**Acceptance Criteria:**

**Given** 用户在日历详情侧边栏
**When** 用户点击"写日记"按钮
**Then** 打开日记编辑器
**And** 编辑器支持Markdown格式
**And** 提供工具栏：加粗、斜体、标题、列表、引用

**When** 用户输入日记内容并保存
**Then** 日记保存到数据库（关联当日日期）
**And** 日历上该日期显示日记标记（📝图标）
**And** 侧边栏显示日记预览（前100字）

**When** 用户点击已有日记
**Then** 在侧边栏展开显示完整日记（Markdown渲染）
**And** 显示"编辑"和"删除"按钮

**When** 用户编辑日记
**Then** 重新打开编辑器，预填充内容
**And** 保存后更新数据库
**And** 显示"更新成功"提示

**When** 用户删除日记
**Then** 显示确认对话框
**And** 确认后删除日记
**And** 日历上的日记标记消失

---

## Story 4.5: 提醒事项功能

As a **学习者**,
I want **在日历上管理学习相关的待办事项**,
So that **我可以在一个地方统一管理学习计划**.

**Acceptance Criteria:**

**Given** 用户在日历视图
**When** 用户点击未来某日期并选择"添加提醒"
**Then** 打开提醒编辑表单
**And** 表单包含字段：
- 标题（必填）
- 描述（可选）
- 日期（默认选中的日期）
- 时间（可选，默认09:00）

**When** 用户保存提醒
**Then** 提醒保存到数据库
**And** 日历上该日期显示提醒标记（🔔图标）
**And** 侧边栏显示提醒列表

**When** 用户点击提醒
**Then** 显示提醒详情
**And** 显示"标记完成"和"编辑"按钮

**When** 用户标记提醒完成
**Then** 提醒状态更新为"已完成"
**And** 日历图标变为"✓"
**And** 列表中提醒显示删除线

**When** 提醒时间到达
**Then** 发送桌面通知
**And** 通知标题为提醒标题
**And** 点击通知打开应用并显示提醒详情

**And** 系统托盘显示未完成提醒数量徽章

---

## Epic 4 完成！

✅ **已创建5个Stories**
- Story 4.1: 日历热力图基础
- Story 4.2: 多视图切换
- Story 4.3: 今日摘要和每日统计
- Story 4.4: 日记功能
- Story 4.5: 提醒事项功能

✅ **覆盖需求验证：**
- ✅ FR19-FR21: 月历视图和每日活动显示 → Story 4.1
- ✅ FR22: 点击日期查看详情 → Story 4.1
- ✅ FR23-FR24: 下次复习时间和视觉区分 → Story 4.1
- ✅ FR25-FR26: 每日摘要和视图切换 → Story 4.2, 4.3
- ✅ FR27-FR32: 日记管理全部功能 → Story 4.4
- ✅ FR33-FR39: 提醒事项全部功能 → Story 4.5
- ✅ FR44-FR49: 统计与分析 → Story 4.3
